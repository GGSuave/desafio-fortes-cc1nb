<!DOCTYPE html>
<html lang="pt-br">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0"
		/>
		<title>Fortes-Coordenador</title>
		<link rel="stylesheet" href="./../style/main.css" />
		<link rel="stylesheet" href="./style/style.css" />
		<link
			rel="shortcut icon"
			href="../img/logo/logo.png"
			type="image/x-icon"
		/>
	</head>
	<body>
		<header class="center flex w-full">
			<div class="w-80 flex cabecalho-logado">
				<div class="w-50">
					<div class="flex gap items-center">
						<div class="logo flex gap items-center">
							<img
								src="../img/logo/logo.png"
								alt="Logo da Fortes"
								class="img-fortes"
							/>
							<h3 id="nome-forte">Fortes</h3>
						</div>
						<span class="cabecalho-funcao"
							>Coordenador</span
						>
					</div>
				</div>
				<div class="w-50 div-perfil flex gap">
					<img
						src="../img/perfil/carla.png"
						alt="Foto de Perfil"
						class="img-perfil"
					/><button onclick="sair()" class="btn-sair">
						<img
							src="./../img/icon/sair.png"
							alt="sair da conta"
							class="img-sair"
							title="Sair da conta"
						/>
					</button>
				</div>
			</div>
		</header>
		<main class="flex center w-full">
			<div class="div-main">
				<div class="saudacao center flex column">
					<h2>Bem-vinda,Carla!</h2>
					<p>
						Gerencie seus eventos e acompanhe o impacto
						ambiental da sua organização.
					</p>
				</div>
				<div class="div-cards flex gap items-center center">
					<div class="cards">
						<div class="flex">
							<div class="w-50">
								<p>Eventos Ativos</p>
								<h3 id="eventos-ativos">3</h3>
							</div>
							<div
								class="w-50 flex items-center center"
							>
								<div class="calender img-card">
									<img
										src="./../img/icon/calendr.svg"
										alt=""
									/>
								</div>
							</div>
						</div>
						<div class="flex items-center gap-5px">
							<img
								src="./../img/icon/grafico-subida.svg"
								alt="gráfico subindo"
								class="img-grafico"
							/><span class="subiu"
								>+2 este mês</span
							>
						</div>
					</div>
					<div class="cards">
						<div class="flex">
							<div class="w-50">
								<p>Resíduos Coletados</p>
								<h3 id="residuos-coletados">
									180kg
								</h3>
							</div>
							<div
								class="w-50 flex items-center center"
							>
								<div class="img-card reciclar">
									<img
										src="./../img/icon/reciclagem.svg"
										alt=""
									/>
								</div>
							</div>
						</div>
						<div class="flex items-center gap-5px">
							<img
								src="./../img/icon/grafico-subida.svg"
								alt="gráfico subindo"
								class="img-grafico"
							/><span class="subiu"
								>+15%a mais esse mês</span
							>
						</div>
					</div>
					<div class="cards">
						<div class="flex">
							<div class="w-50">
								<p>Participantes</p>
								<h3 id="total-participantes">
									780
								</h3>
							</div>
							<div
								class="w-50 flex items-center center"
							>
								<div
									class="participantes img-card"
								>
									<img
										src="./../img/icon/user-management.svg"
										alt=""
									/>
								</div>
							</div>
						</div>
						<div class="flex items-center gap-5px">
							<img
								src="./../img/icon/grafico-subida.svg"
								alt="gráfico subindo"
								class="img-grafico"
							/><span
								class="subiu"
								id="media-participantes"
								>Média de 260/evento</span
							>
						</div>
					</div>
					<div class="cards">
						<div class="flex">
							<div class="w-50">
								<p>Cooperativas</p>
								<h3>5</h3>
							</div>
							<div
								class="w-50 flex items-center center"
							>
								<div class="gps img-card">
									<img
										src="./../img/icon/gps.svg"
										alt=""
									/>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="div-notificacoes my">
					<div class="notificacoes-header">
						<img
							src="./../img/icon/notification.svg"
							alt="Ícone de sino de Notificações"
							class="notificacoes-bell-icon"
						/>
						<h2>Notificações</h2>
					</div>
					<ul id="notificacoes-list">
						<li class="notificacao-item">
							<span
								class="notificacao-status-dot status-confirmado-dot"
							></span>
							<div class="notificacao-content">
								<p>
									Coleta confirmada para
									Festival de Verão
								</p>
								<span>2h atrás</span>
							</div>
						</li>
						<li class="notificacao-item">
							<span
								class="notificacao-status-dot status-pendente-dot"
							></span>
							<div class="notificacao-content">
								<p>
									Aguardando
									confirmação-Feira
									Comunitária
								</p>
								<span>4h atrás</span>
							</div>
						</li>
						<li class="notificacao-item">
							<span
								class="notificacao-status-dot status-agendado-dot"
							></span>
							<div class="notificacao-content">
								<p>Novo relatório disponível</p>
								<span>1 dia atrás</span>
							</div>
						</li>
					</ul>
				</div>
				<div class="datagrid my">
					<div class="flex datagrid-header">
						<div>
							<h2>Meus Eventos</h2>
							<span
								>Gerencie e acompanhe seus
								eventos</span
							>
						</div>
						<div class="datagrid-header-actions">
							<div class="busca-container">
								<input
									type="text"
									id="busca-eventos"
									placeholder="Buscar eventos..."
									class="input-busca"
									onkeyup="buscarEventos()"
								/>
							</div>
							<a
								href="./cadastro.html"
								class="btn-novo-evento"
								>+ Novo Evento</a
							>
						</div>
					</div>
					<div>
						<ul id="datagrid-list">
							<!-- Os eventos serão carregados aqui dinamicamente -->
						</ul>
					</div>
				</div>
			</div>
		</main>

		<script src="./script/eventos-crud.js"></script>
		<script src="./../script/funcoes-main.js"></script>
		<script>
			// Funções para gerenciar eventos
			function editarEvento(id) {
				const evento = eventosCRUD.getEventoPorId(id);
				if (!evento) {
					alert("Evento não encontrado!");
					return;
				}
				window.location.href = "./cadastro.html?edit=" + id;
			}

			function excluirEvento(id) {
				const evento = eventosCRUD.getEventoPorId(id);
				if (!evento) {
					alert("Evento não encontrado!");
					return;
				}

				if (
					confirm(
						`Tem certeza que deseja excluir o evento "${evento.nome}"?`
					)
				) {
					const sucesso = eventosCRUD.excluirEvento(id);
					if (sucesso) {
						alert("Evento excluído com sucesso!");
						carregarEventos();
						carregarEstatisticas();
					} else {
						alert("Erro ao excluir evento!");
					}
				}
			}

			function buscarEventos() {
				const termo =
					document.getElementById("busca-eventos")?.value ||
					"";
				const eventos = termo
					? eventosCRUD.buscarEventos(termo)
					: eventosCRUD.getEventos();
				renderizarEventos(eventos);
			}

			function formatarData(dataString) {
				const data = new Date(dataString);
				return data.toLocaleDateString("pt-BR");
			}

			function formatarStatus(status) {
				const statusMap = {
					confirmado: {
						texto: "Confirmado",
						classe: "status-confirmado",
					},
					pendente: {
						texto: "Pendente",
						classe: "status-pendente",
					},
					agendado: {
						texto: "Agendado",
						classe: "status-agendado",
					},
					cancelado: {
						texto: "Cancelado",
						classe: "status-cancelado",
					},
				};
				return (
					statusMap[status] || {
						texto: status,
						classe: "status-pendente",
					}
				);
			}

			function renderizarEventos(eventos) {
				const listaEventos =
					document.getElementById("datagrid-list");
				if (!listaEventos) return;

				listaEventos.innerHTML = "";

				if (eventos.length === 0) {
					listaEventos.innerHTML =
						'<li class="sem-eventos">Nenhum evento encontrado</li>';
					return;
				}

				eventos.forEach((evento) => {
					const statusInfo = formatarStatus(evento.status);
					const dataFormatada = formatarData(evento.data);

					const li = document.createElement("li");
					li.className = "flex datagrid-item";
					li.innerHTML = `
						<div class="datagrid-icon-div">
							<img src="./../img/icon/calendr.svg" alt="Ícone de Calendário" />
						</div>
						<div class="datagrid-details">
							<h4>${evento.nome}</h4>
							<div class="datagrid-info-line">
								<img src="./../img/icon/clock.svg" alt="Hora" class="info-icon" />
								<span>${dataFormatada}</span>
							</div>
							<div class="datagrid-info-line">
								<img src="./../img/icon/map-pin.svg" alt="Local" class="info-icon" />
								<span>${evento.local}</span>
							</div>
							<div class="datagrid-info-line">
								<img src="./../img/icon/users.svg" alt="Pessoas" class="info-icon" />
								<span>${evento.publicoEstimado} pessoas</span>
							</div>
						</div>
						<div class="datagrid-metrics">
							<h4>${evento.residuosEstimados}Kg</h4>
							<span>estimativa</span>
						</div>
						<div class="datagrid-status">
							<span class="${statusInfo.classe}">${statusInfo.texto}</span>
						</div>
						<div class="datagrid-actions">
							<button onclick="editarEvento(${evento.id})" class="btn-acao btn-editar" title="Editar evento">
								<img src="./../img/icon/edit.svg" alt="Editar" class="icon-acao" />
							</button>
							<button onclick="excluirEvento(${evento.id})" class="btn-acao btn-excluir" title="Excluir evento">
								<img src="./../img/icon/trash.svg" alt="Excluir" class="icon-acao" />
							</button>
						</div>
					`;

					listaEventos.appendChild(li);
				});
			}

			function carregarEventos() {
				const eventos = eventosCRUD.getEventos();
				renderizarEventos(eventos);
			}

			function carregarEstatisticas() {
				const stats = eventosCRUD.getEstatisticas();

				const elementos = {
					eventosAtivos:
						document.getElementById("eventos-ativos"),
					residuosColetados:
						document.getElementById(
							"residuos-coletados"
						),
					participantes: document.getElementById(
						"total-participantes"
					),
					mediaParticipantes: document.getElementById(
						"media-participantes"
					),
				};

				if (elementos.eventosAtivos)
					elementos.eventosAtivos.textContent =
						stats.eventosAtivos;
				if (elementos.residuosColetados)
					elementos.residuosColetados.textContent = `${stats.totalResiduos}kg`;
				if (elementos.participantes)
					elementos.participantes.textContent =
						stats.totalParticipantes;
				if (elementos.mediaParticipantes)
					elementos.mediaParticipantes.textContent = `Média de ${stats.mediaParticipantesPorEvento}/evento`;
			}

			// Inicializar página quando carregar
			document.addEventListener("DOMContentLoaded", function () {
				carregarEventos();
				carregarEstatisticas();
			});
		</script>
	</body>
</html>
